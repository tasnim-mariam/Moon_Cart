<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Customer Dashboard - View orders and manage account"
        />
        <title>My Account - MoonCart</title>

        <!-- Favicon -->
        <link rel="icon" type="image/png" href="assets/images/favicon.png" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/responsive.css" />

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    </head>
    <body>
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container">
                <div class="top-bar-content">
                    <div class="top-bar-left">
                        <span
                            ><i class="fas fa-phone-alt"></i> +1 234 567
                            8900</span
                        >
                        <span
                            ><i class="fas fa-envelope"></i>
                            info@mooncart.com</span
                        >
                    </div>
                    <div class="top-bar-right">
                        <span class="delivery-badge"
                            ><i class="fas fa-shipping-fast"></i> Free delivery
                            on orders over $50</span
                        >
                        <div class="social-icons">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="header">
            <div class="container">
                <nav class="navbar">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="logo-text">
                            <span class="logo-main"
                                >Moon<span class="logo-accent">Cart</span></span
                            >
                            <span class="logo-tagline">Fresh & Fast</span>
                        </div>
                    </a>

                    <ul class="nav-menu">
                        <li>
                            <a href="index.html" class="nav-link">
                                <i class="fas fa-home"></i>
                                <span>Home</span>
                            </a>
                        </li>
                        <li>
                            <a href="products.html" class="nav-link">
                                <i class="fas fa-utensils"></i>
                                <span>Products</span>
                            </a>
                        </li>
                        <li>
                            <a href="about.html" class="nav-link">
                                <i class="fas fa-info-circle"></i>
                                <span>About</span>
                            </a>
                        </li>
                        <li>
                            <a href="contact.html" class="nav-link">
                                <i class="fas fa-envelope"></i>
                                <span>Contact</span>
                            </a>
                        </li>
                        <li>
                            <a href="product-requests.html" class="nav-link">
                                <i class="fas fa-comments"></i>
                                <span>Product Requests</span>
                            </a>
                        </li>
                    </ul>

                    <div class="nav-actions">
                        <a href="cart.html" class="cart-icon-wrapper">
                            <div class="cart-icon">
                                <i class="fas fa-shopping-bag"></i>
                                <span class="cart-count">0</span>
                            </div>
                            <span class="cart-text">Cart</span>
                        </a>
                        <!-- Account Section (Dynamic) -->
                        <div id="account-section" class="account-section">
                            <div class="auth-buttons">
                                <a href="login.html" class="btn-login">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Login</span>
                                </a>
                                <a href="signup.html" class="btn-signup">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Sign Up</span>
                                </a>
                            </div>
                        </div>

                        <div class="menu-toggle">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Dashboard -->
        <div class="dashboard">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-divider">
                    <span>MAIN MENU</span>
                </div>

                <div class="sidebar-menu">
                    <a
                        href="#dashboard"
                        class="sidebar-link active"
                        onclick="showSection('dashboard')"
                    >
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                    <a
                        href="#orders"
                        class="sidebar-link"
                        onclick="showSection('orders')"
                    >
                        <i class="fas fa-shopping-bag"></i> My Orders
                    </a>
                    <a
                        href="#addresses"
                        class="sidebar-link"
                        onclick="showSection('addresses')"
                    >
                        <i class="fas fa-map-marker-alt"></i> Addresses
                    </a>
                    <a
                        href="#profile"
                        class="sidebar-link"
                        onclick="showSection('profile')"
                    >
                        <i class="fas fa-user"></i> Profile
                    </a>

                    <div class="sidebar-divider">
                        <span>ACCOUNT</span>
                    </div>

                    <a
                        href="javascript:logout()"
                        class="sidebar-link sidebar-link-logout"
                    >
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="dashboard-content">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="dashboard-section">
                    <h2
                        style="
                            margin-bottom: 30px;
                            font-size: 28px;
                            font-weight: 700;
                            color: var(--text-dark);
                        "
                    >Welcome, <span id="welcome-name">John</span>!</h2>

                    <!-- Stats Grid - Modern Cards -->
                    <div
                        style="
                            display: grid;
                            grid-template-columns: repeat(
                                auto-fit,
                                minmax(240px, 1fr)
                            );
                            gap: 20px;
                            margin-bottom: 30px;
                        "
                    >
                        <!-- Total Orders Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #667eea 0%,
                                    #764ba2 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Total Orders
                                </div>
                                <div
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    8
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-arrow-up"></i> 2 from last
                                    month
                                </div>
                            </div>
                        </div>

                        <!-- Pending Orders Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #fa709a 0%,
                                    #fee140 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(250, 112, 154, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-clock"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Pending Orders
                                </div>
                                <div
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    2
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-check"></i> Ready for
                                    delivery
                                </div>
                            </div>
                        </div>

                        <!-- Total Spent Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #f093fb 0%,
                                    #f5576c 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Total Spent
                                </div>
                                <div
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    ৳485.50
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-chart-line"></i> ৳125 this
                                    month
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div
                        style="
                            display: grid;
                            grid-template-columns: 2fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        "
                    >
                        <!-- Spending Chart -->
                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
                            "
                        >
                            <h3
                                style="
                                    margin-bottom: 20px;
                                    font-size: 18px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                "
                            >
                                <i
                                    class="fas fa-chart-area"
                                    style="
                                        color: var(--primary-color);
                                        margin-right: 8px;
                                    "
                                ></i>
                                Monthly Spending
                            </h3>
                            <canvas
                                id="customerSpendingChart"
                                style="max-height: 300px"
                            ></canvas>
                        </div>

                        <!-- Order Status Pie Chart -->
                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
                            "
                        >
                            <h3
                                style="
                                    margin-bottom: 20px;
                                    font-size: 18px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                "
                            >
                                <i
                                    class="fas fa-chart-pie"
                                    style="
                                        color: var(--primary-color);
                                        margin-right: 8px;
                                    "
                                ></i>
                                Order Categories
                            </h3>
                            <canvas
                                id="customerCategoryChart"
                                style="max-height: 300px"
                            ></canvas>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                            margin-top: 30px;
                        "
                    >
                        <h3 style="margin-bottom: 20px">Quick Actions</h3>
                        <div
                            style="
                                display: grid;
                                grid-template-columns: repeat(
                                    auto-fit,
                                    minmax(200px, 1fr)
                                );
                                gap: 15px;
                            "
                        >
                            <button
                                class="btn btn-primary"
                                onclick="window.location.href='products.html'"
                            >
                                <i class="fas fa-shopping-cart"></i> Continue
                                Shopping
                            </button>
                            <button
                                class="btn btn-secondary"
                                onclick="window.location.href='cart.html'"
                            >
                                <i class="fas fa-shopping-bag"></i> View Cart
                            </button>
                            <button
                                class="btn btn-outline"
                                onclick="showSection('orders')"
                            >
                                <i class="fas fa-list"></i> Track Orders
                            </button>
                            <button
                                class="btn btn-outline"
                                onclick="window.location.href='product-requests.html'"
                            >
                                <i class="fas fa-plus"></i> Request Product
                            </button>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                            margin-top: 30px;
                        "
                    >
                        <h3 style="margin-bottom: 20px">Recent Orders</h3>
                        <div id="customer-orders">
                            <!-- Orders will be dynamically inserted here -->
                        </div>
                    </div>
                </section>

                <!-- Orders Section -->
                <section
                    id="orders-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                        "
                    >
                        <div style="margin-bottom: 20px">
                            <input
                                type="text"
                                id="order-search"
                                class="form-input"
                                placeholder="Search orders by ID, items, or status..."
                                style="max-width: 400px; margin: 0"
                                onkeyup="searchOrders()"
                            />
                        </div>

                        <div id="customer-orders-full">
                            <!-- Full orders list will be inserted here -->
                        </div>
                    </div>
                </section>

                <!-- Addresses Section -->
                <section
                    id="addresses-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div style="margin-bottom: 20px">
                        <button
                            class="btn btn-primary"
                            onclick="openModal('add-address-modal')"
                        >
                            <i class="fas fa-plus"></i> Add New Address
                        </button>
                    </div>

                    <div
                        style="
                            display: grid;
                            grid-template-columns: repeat(
                                auto-fill,
                                minmax(300px, 1fr)
                            );
                            gap: 20px;
                        "
                    >
                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: var(--border-radius);
                                box-shadow: var(--shadow);
                                border-left: 4px solid var(--primary-color);
                            "
                        >
                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: start;
                                    margin-bottom: 15px;
                                "
                            >
                                <h4><i class="fas fa-home"></i> Home</h4>
                                <span
                                    style="
                                        background: var(--primary-color);
                                        color: white;
                                        padding: 3px 10px;
                                        border-radius: 12px;
                                        font-size: 12px;
                                    "
                                    >Default</span
                                >
                            </div>
                            <p
                                style="
                                    color: var(--text-light);
                                    margin-bottom: 15px;
                                "
                            >
                                123 Main Street, Apt 4B<br />
                                New York, NY 10001<br />
                                Phone: +1 234 567 8900
                            </p>
                            <div style="display: flex; gap: 10px">
                                <button class="btn btn-sm" onclick="editAddress('home')">Edit</button>
                                <button
                                    class="btn btn-sm"
                                    style="background: var(--danger-color)"
                                    onclick="deleteAddress('home')"
                                >
                                    Delete
                                </button>
                            </div>
                        </div>

                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: var(--border-radius);
                                box-shadow: var(--shadow);
                            "
                        >
                            <h4 style="margin-bottom: 15px">
                                <i class="fas fa-briefcase"></i> Office
                            </h4>
                            <p
                                style="
                                    color: var(--text-light);
                                    margin-bottom: 15px;
                                "
                            >
                                456 Corporate Ave, Suite 200<br />
                                New York, NY 10002<br />
                                Phone: +1 234 567 8900
                            </p>
                            <div style="display: flex; gap: 10px">
                                <button class="btn btn-sm" onclick="editAddress('office')">Edit</button>
                                <button
                                    class="btn btn-sm"
                                    style="background: var(--danger-color)"
                                    onclick="deleteAddress('office')"
                                >
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Profile Section -->
                <section
                    id="profile-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                        "
                    >
                        <form>
                            <div
                                style="text-align: center; margin-bottom: 30px"
                            >
                                <div
                                    style="
                                        width: 120px;
                                        height: 120px;
                                        background: var(--primary-color);
                                        border-radius: 50%;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 48px;
                                        font-weight: 700;
                                        color: white;
                                        margin-bottom: 15px;
                                    "
                                >
                                    JD
                                </div>
                                <button type="button" class="btn btn-outline">
                                    Change Photo
                                </button>
                            </div>

                            <div
                                style="
                                    display: grid;
                                    grid-template-columns: 1fr 1fr;
                                    gap: 20px;
                                "
                            >
                                <div class="form-group">
                                    <label class="form-label">First Name</label>
                                    <input
                                        type="text"
                                        class="form-input"
                                        value="John"
                                    />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Last Name</label>
                                    <input
                                        type="text"
                                        class="form-input"
                                        value="Doe"
                                    />
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input
                                    type="email"
                                    class="form-input"
                                    value="john@example.com"
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input
                                    type="tel"
                                    class="form-input"
                                    value="+1 234 567 8900"
                                />
                            </div>

                            <hr style="margin: 30px 0" />

                            <h3 style="margin-bottom: 20px">Change Password</h3>

                            <div class="form-group">
                                <label class="form-label"
                                    >Current Password</label
                                >
                                <input
                                    type="password"
                                    class="form-input"
                                    placeholder="Enter current password"
                                />
                            </div>

                            <div
                                style="
                                    display: grid;
                                    grid-template-columns: 1fr 1fr;
                                    gap: 20px;
                                "
                            >
                                <div class="form-group">
                                    <label class="form-label"
                                        >New Password</label
                                    >
                                    <input
                                        type="password"
                                        class="form-input"
                                        placeholder="Enter new password"
                                    />
                                </div>

                                <div class="form-group">
                                    <label class="form-label"
                                        >Confirm Password</label
                                    >
                                    <input
                                        type="password"
                                        class="form-input"
                                        placeholder="Confirm new password"
                                    />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </section>
            </main>
        </div>

        <!-- Order Details Modal -->
        <div id="order-details-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
            <div class="modal-content" style="max-width: 900px; background: white; border-radius: 12px; max-height: 90vh; overflow-y: auto; position: relative;">
                <span
                    class="modal-close"
                    onclick="document.getElementById('order-details-modal').style.display='none'"
                    style="position: absolute; right: 20px; top: 20px; font-size: 28px; cursor: pointer; color: #999; z-index: 1;"
                    >&times;</span
                >
                <div id="order-details"></div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="js/main.js"></script>
        <script src="js/cart.js"></script>
        <script src="js/order.js"></script>
        <script src="js/ui.js"></script>
        <script>
            // Mock customer user
            const mockUser = {
                id: "cust1",
                name: "John Doe",
                email: "john@example.com",
                role: "customer",
            };
            MoonCart.saveCurrentUser(mockUser);

            // Create mock orders data with proper structure
            const mockOrders = [
                {
                    id: 'ORD' + Date.now().toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+1 234 567 8900",
                    address: "123 Main Street, Apt 4B",
                    city: "New York",
                    zipCode: "10001",
                    deliverySlot: "12:00 AM - 1:00 AM",
                    paymentMethod: "card",
                    items: [
                        { id: 'p1', name: 'Margherita Pizza', quantity: 2, price: 12.99, image: 'pizza.jpg', category: 'food' },
                        { id: 'p2', name: 'Garlic Bread', quantity: 1, price: 4.99, image: 'bread.jpg', category: 'food' }
                    ],
                    orderDate: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
                    status: "delivered",
                    subtotal: 30.97,
                    tax: 3.10,
                    shipping: 0,
                    total: 34.07,
                    itemCount: 3
                },
                {
                    id: 'ORD' + (Date.now() - 1000).toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+1 234 567 8900",
                    address: "123 Main Street, Apt 4B",
                    city: "New York",
                    zipCode: "10001",
                    deliverySlot: "1:00 AM - 2:00 AM",
                    paymentMethod: "card",
                    items: [
                        { id: 'p3', name: 'Chicken Burger', quantity: 1, price: 8.99, image: 'burger.jpg', category: 'food' },
                        { id: 'p4', name: 'French Fries', quantity: 2, price: 3.99, image: 'fries.jpg', category: 'food' },
                        { id: 'p5', name: 'Cola', quantity: 1, price: 1.99, image: 'cola.jpg', category: 'beverages' }
                    ],
                    orderDate: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
                    status: "delivered",
                    subtotal: 18.96,
                    tax: 1.90,
                    shipping: 50,
                    total: 70.86,
                    itemCount: 4
                },
                {
                    id: 'ORD' + (Date.now() - 2000).toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+1 234 567 8900",
                    address: "456 Corporate Ave, Suite 200",
                    city: "New York",
                    zipCode: "10002",
                    deliverySlot: "2:00 AM - 3:00 AM",
                    paymentMethod: "card",
                    items: [
                        { id: 'p6', name: 'Pasta Alfredo', quantity: 1, price: 14.99, image: 'pasta.jpg', category: 'food' },
                        { id: 'p7', name: 'Caesar Salad', quantity: 1, price: 6.99, image: 'salad.jpg', category: 'food' }
                    ],
                    orderDate: new Date(Date.now() - 259200000).toISOString(), // 3 days ago
                    status: "delivered",
                    subtotal: 21.98,
                    tax: 2.20,
                    shipping: 50,
                    total: 74.18,
                    itemCount: 2
                },
                {
                    id: 'ORD' + (Date.now() - 3000).toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+1 234 567 8900",
                    address: "123 Main Street, Apt 4B",
                    city: "New York",
                    zipCode: "10001",
                    deliverySlot: "3:00 AM - 4:00 AM",
                    paymentMethod: "card",
                    items: [
                        { id: 'p8', name: 'Sushi Roll Set', quantity: 1, price: 24.99, image: 'sushi.jpg', category: 'food' },
                        { id: 'p9', name: 'Miso Soup', quantity: 2, price: 3.99, image: 'soup.jpg', category: 'food' }
                    ],
                    orderDate: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago
                    status: "pending",
                    subtotal: 32.97,
                    tax: 3.30,
                    shipping: 0,
                    total: 36.27,
                    itemCount: 3
                },
                {
                    id: 'ORD' + (Date.now() - 4000).toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+1 234 567 8900",
                    address: "123 Main Street, Apt 4B",
                    city: "New York",
                    zipCode: "10001",
                    deliverySlot: "12:00 AM - 1:00 AM",
                    paymentMethod: "card",
                    items: [
                        { id: 'p10', name: 'Medicine Package', quantity: 1, price: 45.50, image: 'medicine.jpg', category: 'medicine' }
                    ],
                    orderDate: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                    status: "confirmed",
                    subtotal: 45.50,
                    tax: 4.55,
                    shipping: 0,
                    total: 50.05,
                    itemCount: 1
                }
            ];

            // Save mock orders to localStorage
            localStorage.setItem('mooncart_orders', JSON.stringify(mockOrders));

            // Update customer info (with safe checks)
            const customerNameEl = document.getElementById("customer-name");
            const customerEmailEl = document.getElementById("customer-email");
            const welcomeNameEl = document.getElementById("welcome-name");
            
            if (customerNameEl) customerNameEl.textContent = mockUser.name;
            if (customerEmailEl) customerEmailEl.textContent = mockUser.email;
            if (welcomeNameEl) welcomeNameEl.textContent = mockUser.name.split(" ")[0];

            // Search orders function
            function searchOrders() {
                const searchTerm = document.getElementById('order-search').value.toLowerCase();
                const orders = MoonCart.getOrders().filter(order => order.customerId === mockUser.id);
                
                const filteredOrders = orders.filter(order => {
                    const orderId = order.id.toLowerCase();
                    const status = order.status.toLowerCase();
                    const itemNames = order.items.map(item => item.name.toLowerCase()).join(' ');
                    
                    return orderId.includes(searchTerm) || 
                           status.includes(searchTerm) || 
                           itemNames.includes(searchTerm);
                });
                
                displayFilteredOrders(filteredOrders);
            }

            // View order details function
            function viewOrderDetails(orderId) {
                const orders = MoonCart.getOrders();
                const order = orders.find(o => o.id === orderId);
                
                if (!order) {
                    alert('Order not found!');
                    return;
                }

                const modal = document.getElementById('order-details-modal');
                const detailsContainer = document.getElementById('order-details');
                
                if (!modal || !detailsContainer) {
                    console.error('Modal or details container not found');
                    return;
                }

                // Populate order details
                detailsContainer.innerHTML = `
                    <div style="padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid var(--primary-color); padding-bottom: 15px;">
                            <h2 style="margin: 0; color: var(--text-dark);">Order #${order.id.substring(0, 8).toUpperCase()}</h2>
                            <span class="status-badge status-${order.status}" style="padding: 8px 16px; font-size: 14px; font-weight: 600;">${order.status}</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: var(--light-bg); padding: 20px; border-radius: 10px;">
                                <h3 style="margin: 0 0 15px; color: var(--primary-color); font-size: 16px;">
                                    <i class="fas fa-user"></i> Customer Information
                                </h3>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Name:</strong> ${order.customerName}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Email:</strong> ${order.email}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Phone:</strong> ${order.phone}</p>
                            </div>
                            
                            <div style="background: var(--light-bg); padding: 20px; border-radius: 10px;">
                                <h3 style="margin: 0 0 15px; color: var(--primary-color); font-size: 16px;">
                                    <i class="fas fa-map-marker-alt"></i> Delivery Address
                                </h3>
                                <p style="margin: 5px 0; color: var(--text-dark);">${order.address}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);">${order.city}, ${order.zipCode}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Slot:</strong> ${order.deliverySlot}</p>
                            </div>
                            
                            <div style="background: var(--light-bg); padding: 20px; border-radius: 10px;">
                                <h3 style="margin: 0 0 15px; color: var(--primary-color); font-size: 16px;">
                                    <i class="fas fa-calendar"></i> Order Summary
                                </h3>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Date:</strong> ${new Date(order.orderDate).toLocaleDateString()}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Time:</strong> ${new Date(order.orderDate).toLocaleTimeString()}</p>
                                <p style="margin: 5px 0; color: var(--text-dark);"><strong>Payment:</strong> ${order.paymentMethod}</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h3 style="margin: 0 0 15px; color: var(--text-dark); font-size: 18px;">
                                <i class="fas fa-shopping-cart"></i> Order Items
                            </h3>
                            <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: var(--primary-color); color: white;">
                                        <th style="padding: 12px; text-align: left;">Product</th>
                                        <th style="padding: 12px; text-align: center;">Quantity</th>
                                        <th style="padding: 12px; text-align: right;">Price</th>
                                        <th style="padding: 12px; text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${order.items.map((item, index) => `
                                        <tr style="border-bottom: 1px solid #eee; ${index % 2 === 0 ? 'background: #f9f9f9;' : ''}">
                                            <td style="padding: 12px; color: var(--text-dark);">${item.name}</td>
                                            <td style="padding: 12px; text-align: center; color: var(--text-dark);">${item.quantity}</td>
                                            <td style="padding: 12px; text-align: right; color: var(--text-dark);">${MoonCart.formatCurrency(item.price)}</td>
                                            <td style="padding: 12px; text-align: right; font-weight: 600; color: var(--text-dark);">${MoonCart.formatCurrency(item.price * item.quantity)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="background: var(--light-bg); padding: 20px; border-radius: 10px; max-width: 400px; margin-left: auto;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-dark);">
                                <span>Subtotal:</span>
                                <span style="font-weight: 600;">${MoonCart.formatCurrency(order.subtotal)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-dark);">
                                <span>Tax (10%):</span>
                                <span style="font-weight: 600;">${MoonCart.formatCurrency(order.tax)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-dark);">
                                <span>Shipping:</span>
                                <span style="font-weight: 600;">${order.shipping === 0 ? 'FREE' : MoonCart.formatCurrency(order.shipping)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; margin-top: 10px; border-top: 2px solid var(--primary-color); font-size: 18px; font-weight: 700; color: var(--primary-color);">
                                <span>Total:</span>
                                <span>${MoonCart.formatCurrency(order.total)}</span>
                            </div>
                        </div>
                    </div>
                `;

                // Show modal
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
            }

            // Display filtered orders
            function displayFilteredOrders(orders) {
                const container = document.getElementById("customer-orders-full2");
                if (!container) return;

                if (orders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No orders found</h3>
                            <p>Try a different search term.</p>
                        </div>
                    `;
                    return;
                }

                orders.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders
                                .map(
                                    (order) => `
                                <tr>
                                    <td>#${order.id.substring(0, 8).toUpperCase()}</td>
                                    <td>${MoonCart.formatDate(order.orderDate)}</td>
                                    <td>${order.itemCount} items</td>
                                    <td>${MoonCart.formatCurrency(order.total)}</td>
                                    <td><span class="status-badge status-${order.status}">${
                                        order.status
                                    }</span></td>
                                    <td>
                                        <button class="btn btn-sm" onclick="viewOrderDetails('${
                                            order.id
                                        }')" style="background: #28a745; color: white; border: none;">View</button>
                                    </td>
                                </tr>
                            `
                                )
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Load orders on page load
            document.addEventListener("DOMContentLoaded", function () {
                // Render orders in dashboard
                renderCustomerOrders();

                // Also render in the full orders section
                setTimeout(() => {
                    const fullSection = document.getElementById("customer-orders-full");
                    if (fullSection) {
                        fullSection.innerHTML = '<div id="customer-orders-full2"></div>';
                        displayFilteredOrders(MoonCart.getOrders().filter(order => order.customerId === mockUser.id));
                    }
                }, 100);
            });

            // Show/hide sections
            function showSection(section) {
                // Hide all sections
                document
                    .querySelectorAll(".dashboard-section")
                    .forEach((s) => (s.style.display = "none"));

                // Remove active class from all links
                document
                    .querySelectorAll(".sidebar-link")
                    .forEach((l) => l.classList.remove("active"));

                // Show selected section
                document.getElementById(section + "-section").style.display =
                    "block";

                // Add active class to clicked link
                event.target.closest(".sidebar-link").classList.add("active");
            }

            // Logout function
            function logout() {
                localStorage.removeItem("mooncart_user");
                window.location.href = "index.html";
            }

            // Address management functions
            function editAddress(addressType) {
                const addresses = {
                    'home': '123 Main Street, Apt 4B\nNew York, NY 10001\nPhone: +1 234 567 8900',
                    'office': '456 Corporate Ave, Suite 200\nNew York, NY 10002\nPhone: +1 234 567 8900'
                };
                
                const currentAddress = addresses[addressType];
                const newAddress = prompt(`Edit ${addressType} address:`, currentAddress);
                
                if (newAddress && newAddress !== currentAddress) {
                    alert(`${addressType.charAt(0).toUpperCase() + addressType.slice(1)} address updated successfully!`);
                    // In a real app, you would save this to a database
                }
            }

            function deleteAddress(addressType) {
                if (confirm(`Are you sure you want to delete your ${addressType} address?`)) {
                    alert(`${addressType.charAt(0).toUpperCase() + addressType.slice(1)} address deleted successfully!`);
                    // In a real app, you would remove this from the database and update the UI
                    location.reload();
                }
            }

            // Initialize Charts
            function initCustomerCharts() {
                // Monthly Spending Chart
                const spendingCtx = document.getElementById(
                    "customerSpendingChart"
                );
                if (spendingCtx) {
                    new Chart(spendingCtx, {
                        type: "line",
                        data: {
                            labels: [
                                "Jan",
                                "Feb",
                                "Mar",
                                "Apr",
                                "May",
                                "Jun",
                                "Jul",
                            ],
                            datasets: [
                                {
                                    label: "Spending",
                                    data: [45, 65, 52, 78, 95, 68, 125],
                                    borderColor: "rgba(227, 30, 36, 1)",
                                    backgroundColor: "rgba(227, 30, 36, 0.1)",
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor:
                                        "rgba(227, 30, 36, 1)",
                                    pointBorderColor: "#fff",
                                    pointBorderWidth: 2,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false,
                                },
                                tooltip: {
                                    backgroundColor: "rgba(0, 0, 0, 0.8)",
                                    padding: 12,
                                    titleColor: "#fff",
                                    bodyColor: "#fff",
                                    borderColor: "rgba(227, 30, 36, 1)",
                                    borderWidth: 1,
                                },
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: "rgba(0, 0, 0, 0.05)",
                                    },
                                    ticks: {
                                        callback: function (value) {
                                            return "৳" + value;
                                        },
                                    },
                                },
                                x: {
                                    grid: {
                                        display: false,
                                    },
                                },
                            },
                        },
                    });
                }

                // Order Categories Pie Chart
                const categoryCtx = document.getElementById(
                    "customerCategoryChart"
                );
                if (categoryCtx) {
                    new Chart(categoryCtx, {
                        type: "doughnut",
                        data: {
                            labels: [
                                "Food",
                                "Beverages",
                                "Medicine",
                                "Groceries",
                            ],
                            datasets: [
                                {
                                    data: [40, 25, 20, 15],
                                    backgroundColor: [
                                        "rgba(227, 30, 36, 0.8)",
                                        "rgba(255, 107, 53, 0.8)",
                                        "rgba(23, 162, 184, 0.8)",
                                        "rgba(40, 167, 69, 0.8)",
                                    ],
                                    borderColor: [
                                        "rgba(227, 30, 36, 1)",
                                        "rgba(255, 107, 53, 1)",
                                        "rgba(23, 162, 184, 1)",
                                        "rgba(40, 167, 69, 1)",
                                    ],
                                    borderWidth: 2,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: "bottom",
                                    labels: {
                                        padding: 15,
                                        font: {
                                            size: 12,
                                            family: "Poppins",
                                        },
                                    },
                                },
                                tooltip: {
                                    backgroundColor: "rgba(0, 0, 0, 0.8)",
                                    padding: 12,
                                    borderWidth: 1,
                                },
                            },
                        },
                    });
                }
            }

            // Initialize charts when page loads
            document.addEventListener("DOMContentLoaded", function () {
                initCustomerCharts();
            });
        </script>
    </body>
</html>
